// ==UserScript==
// @name         Predict Grade
// @namespace    http://tampermonkey.net/
// @version      2.0
// @description  try to take over the world!
// @author       You
// @match        https://portal.sfusd.edu/PXP2_Gradebook.aspx?*
// @match        https://studentportal.sfusd.edu/PXP2_Gradebook.aspx?*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=tampermonkey.net
// @grant        none
// ==/UserScript==

console.log("Script started"),setTimeout((function(){console.clear(),console.log("Hello from CEGG"),function(e){const t=$("<div>Predict Grade</div>");t.addClass("menu-pdgrade"),t.css({backdropFilter:"blur(10rem)",textAlign:"center",fontWeight:"bold",opacity:"0.9",padding:"5px",position:"fixed",right:"0",top:"35%",backgroundColor:"#fdff86",display:"flex",justifyContent:"center",flexDirection:"column",width:"150px"});const o=$("<input class='expect-score' placeholder='Expect' type='text'>");o.css({margin:"5px",fontFamily:"Courier New,Courier,Lucida Sans Typewriter,Lucida Typewriter,monospace"});const n=$("<input class='total-test-score' placeholder='Total' type='text'>");n.css({margin:"5px",fontFamily:"Courier New,Courier,Lucida Sans Typewriter,Lucida Typewriter,monospace"});const s=$("<button class='predict-grade-btn'>Predict</button>"),r=$("<div class='result-display'>90% accurate</div>");r.css({overflowWrap:"break-word",fontWeight:"normal"}),t.append(o),t.append(n),t.append(s),t.append(r),e.append(t)}($("body")),$(".predict-grade-btn").click((()=>{const e=function(){console.log("getting grade worth...");const e={};let t=$("#ctl00_CategoryWeights > svg > g.dxc-labels-group > g:nth-child(2)").text();if(0===t.length)return{general:{worth:1,scores:[]}};t=t.split("%").slice(0,-2);let o=[...$("#ctl00_CategoryWeights > svg > g.dxc-axes-group > g.dxc-arg-axis > g.dxc-arg-elements").children()].slice(0,-1);for(let n=0;n<o.length;n++)e[o[n].textContent.replaceAll(" ","")]={worth:parseFloat(t[n])/100,scores:[]};return e}();!function(e){let t=0;$(".assignment-dropdown").length>0&&(t=$(".assignment-dropdown")[0].selectedIndex,$(".assignment-dropdown").remove());const o=$("<select class='assignment-dropdown'></select>");for(const t in e){const n=Object.keys(e).indexOf(t),s=$(`<option value=${t}>${t}&nbsp;${n+1}</option>`);o.append(s)}o.css({marginBlock:"1em"}),$(".menu-pdgrade").append(o),document.querySelector(".assignment-dropdown").selectedIndex=t}(e),function(e){console.log("getting assignment scores...");const t=[...$(".dx-data-row")],o=/(\d+\.?\d*)[^\.\d]+(\d+\.?\d*)/;for(const n of t){const t=n.children,s=t[7].textContent.match(o);if(null!=e.general)null!=s&&e.general.scores.push(s[0]);else{const o=t[3].textContent.replaceAll(" ","");null!=s&&e[o].scores.push(s[0])}}}(e),function(e){console.warn("Number Input Only");const t=$(".menu-pdgrade .expect-score").val().replace(" ","").split(","),o=$(".menu-pdgrade .total-test-score").val().replace(" ","").split(",");console.log("add prediction grade..."),console.log(e);const n=Object.keys(e);for(let s=0;s<t.length;s++)try{if(""===t[s])continue;const r=t[s].split("#");if(isNaN(parseFloat(r[0]))||isNaN(parseFloat(t[s])))continue;null==r[1]&&(r[1]=1),e[n[parseInt(r[1])-1]].scores.push(`${r[0]}/${o[s]}`)}catch(e){if("TypeError"===e.name)throw $(".result-display").text("ERROR"),new Error("TypeError");console.warn(e)}}(e),function(e){let t=[];for(const o in e){let n=0,s=0;const{worth:r,scores:l}=e[o];if(0!==l.length){for(const e of l){const[t,o]=e.split("/");n+=parseFloat(t),s+=parseFloat(o)}t.push(n/s*r)}else t.push(r)}console.log(t);let o=t.reduce(((e,t)=>e+t),0);o=Math.round(1e3*o)/10,console.log(`%c${o}`,"color:yellow;font-size:2rem;font-weight:bold"),$(".result-display").text(o)}(e)}))}),3e3);
