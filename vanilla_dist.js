// ==UserScript==
// @name         Predict Grade
// @namespace    http://tampermonkey.net/
// @version      2.0
// @description  try to take over the world!
// @author       You
// @match        https://portal.sfusd.edu/PXP2_Gradebook.aspx?*
// @match        https://studentportal.sfusd.edu/PXP2_Gradebook.aspx?*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=tampermonkey.net
// @grant        none
// ==/UserScript==

!function(){"use strict";console.log("Script started"),setTimeout((function(){console.clear(),console.log("Hello from CEGG"),function(e){const t=document.createElement("div");t.innerText="Predict Grade",t.classList.add("menu-pdgrade"),t.style.backdropFilter="blur(10rem)",t.style.textAlign="center",t.style.fontWeight="bold",t.style.opacity="0.9",t.style.padding="5px",t.style.position="fixed",t.style.right="0",t.style.top="35%",t.style.backgroundColor="#70c470",t.style.display="flex",t.style.justifyContent="center",t.style.flexDirection="column",t.style.width="150px";const o=document.createElement("input");o.classList.add("expect-score"),o.placeholder="Expect",o.type="text",o.style.margin="5px",o.style.fontFamily="Courier New,Courier,Lucida Sans Typewriter,Lucida Typewriter,monospace";const n=document.createElement("input");n.classList.add("total-test-score"),n.placeholder="Total",n.type="text",n.style.margin="5px",n.style.fontFamily="Courier New,Courier,Lucida Sans Typewriter,Lucida Typewriter,monospace";const l=document.createElement("button");l.innerText="Predict",l.classList.add("predict-grade-btn");const r=document.createElement("div");r.classList.add("result-display"),r.innerText="90% accurate",r.style.overflowWrap="break-word",r.style.fontWeight="normal",t.appendChild(o),t.appendChild(n),t.appendChild(l),t.appendChild(r),e.appendChild(t)}(document.body),document.querySelector(".predict-grade-btn").addEventListener("click",(()=>{const e=function(){console.log("getting grade worth...");const e={};let t=document.querySelector("#ctl00_CategoryWeights > svg > g.dxc-labels-group > g:nth-child(2)").textContent;if(0===t.length)return{general:{worth:1,scores:[]}};t=t.split("%").slice(0,-2);let o=[...document.querySelector("#ctl00_CategoryWeights > svg > g.dxc-axes-group > g.dxc-arg-axis > g.dxc-arg-elements").children].slice(0,-1);for(let n=0;n<o.length;n++)e[o[n].textContent.replaceAll(" ","")]={worth:parseFloat(t[n])/100,scores:[]};return e}();!function(e){let t=0;null!=document.querySelector(".assignment-dropdown")&&(t=document.querySelector(".assignment-dropdown")[0].selectedIndex,document.querySelector(".assignment-dropdown").remove());const o=document.createElement("select");o.classList.add("assignment-dropdown");for(const t in e){const n=Object.keys(e).indexOf(t),l=document.createElement("option");l.value=`${t}`,l.innerText=`${t} ${n+1}`,o.appendChild(l)}o.style.marginBlock="1em",document.querySelector(".menu-pdgrade").appendChild(o),document.querySelector(".assignment-dropdown").selectedIndex=t}(e),function(e){console.log("getting assignment scores...");const t=[...document.querySelectorAll(".dx-data-row")],o=/(\d+\.?\d*)[^\.\d]+(\d+\.?\d*)/;for(const n of t){const t=n.children,l=t[7].textContent.match(o);if(null!=e.general)null!=l&&e.general.scores.push(l[0]);else{const o=t[3].textContent.replaceAll(" ","");null!=l&&e[o].scores.push(l[0])}}}(e),function(e){console.warn("Number Input Only");const t=document.querySelector(".menu-pdgrade .expect-score").value.replace(" ","").split(","),o=document.querySelector(".menu-pdgrade .total-test-score").value.replace(" ","").split(",");console.log("add prediction grade..."),console.log(e);const n=Object.keys(e);for(let l=0;l<t.length;l++)try{if(""===t[l])continue;const r=t[l].split("#");if(isNaN(parseFloat(r[0]))||isNaN(parseFloat(t[l])))continue;null==r[1]&&(r[1]=1),e[n[parseInt(r[1])-1]].scores.push(`${r[0]}/${o[l]}`)}catch(e){if("TypeError"===e.name)throw document.querySelector(".result-display").textContent="ERROR",new Error("TypeError");console.warn(e)}}(e),function(e){let t=[];for(const o in e){let n=0,l=0;const{worth:r,scores:c}=e[o];if(0!==c.length){for(const e of c){const[t,o]=e.split("/");n+=parseFloat(t),l+=parseFloat(o)}t.push(n/l*r)}else t.push(r)}console.log(t);let o=t.reduce(((e,t)=>e+t),0);o=Math.round(1e3*o)/10,console.log(`%c${o}`,"color:yellow;font-size:2rem;font-weight:bold"),document.querySelector(".result-display").textContent=o}(e)}))}),3e3)}();
